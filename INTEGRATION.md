# 网站与机器人对接说明

## 价格同步机制

### 工作原理

1. **数据库共享**: 网站和机器人使用同一个 Prisma 数据库（SQLite）
2. **价格服务**: 机器人通过 `priceService.js` 从数据库读取价格
3. **自动同步**: 机器人每 5 分钟自动刷新价格缓存
4. **实时更新**: 在关键操作时（如显示价格菜单）会重新加载价格

### 价格更新流程

1. **在网站后台更新价格**:
   - 访问 `/dashboard/pricing`
   - 点击编辑按钮
   - 修改价格并保存
   - 价格立即保存到数据库

2. **机器人自动同步**:
   - 机器人每 5 分钟自动刷新价格缓存
   - 或在用户操作时（如点击"购买会员"）自动重新加载价格
   - 无需重启机器人

### 价格数据结构

数据库中的价格表结构：
- `months`: 订阅月数（3, 6, 12）
- `price`: 价格（USDT）
- `isActive`: 是否启用

### 注意事项

1. **首次运行**: 如果数据库中没有价格，机器人会自动创建默认价格（3个月12.5, 6个月16.5, 12个月29.9）

2. **价格缓存**: 机器人使用 60 秒的缓存，减少数据库查询

3. **同步延迟**: 价格更新后，机器人最多 5 分钟内会同步，或在用户操作时立即同步

4. **数据库路径**: 确保机器人和网站使用相同的数据库文件（通过 `DATABASE_URL` 环境变量配置）

## 配置示例

在 `.env` 文件中设置：

```env
DATABASE_URL="file:./prisma/dev.db"
```

确保机器人和网站都能访问这个数据库文件。

